# 待命工具使用指南

> **创建时间**: 2025-11-10  
> **版本**: v4.1.0  
> **功能**: 待命工具 - 5分钟定时器持续监听

---

## 🎯 功能概述

**待命工具** (`standby`) 是一个**固定5分钟定时器**，在5分钟内持续监听任务和消息。如果收到新任务/消息，立即返回继续工作；如果5分钟内没有新任务/消息，继续等待直到5分钟到期。

### 核心特点

1. **固定5分钟定时器**：每次调用standby启动5分钟定时器（强制5分钟）
2. **持续监听**：在5分钟内持续监听任务和消息
3. **立即响应**：收到新任务/消息时立即返回，继续工作
4. **自动重置**：5分钟到期后自动重置，可以开始新的监听周期

---

## 📋 工作流程

### 标准工作流程

```
1. 完成工作
   ↓
2. 调用standby启动5分钟定时器
   ↓
3. 在5分钟内：
   ├─ 收到新任务/消息 → 立即返回，继续工作
   └─ 没有新任务/消息 → 返回"继续监听中"，显示剩余时间
   ↓
4. 继续调用standby（在5分钟内可以多次调用）
   ↓
5. 5分钟到期 → 定时器重置，可以开始新的5分钟监听周期
```

### 示例流程

**员工A完成前端开发后**：

```
# 第1次调用standby
standby({
  "status_message": "前端开发完成，等待新任务"
})

# 返回（如果没有新任务）：
# ✅ 待命状态：持续监听中（5分钟定时器）
# 待命ID: a_session123_2025-11-10T12:00:00
# 剩余时间: 4分58秒
# 💡 提示: 暂无新任务/消息，继续监听中...
# 请在剩余时间内继续调用standby检查

# 第2次调用standby（30秒后）
standby({
  "status_message": "前端开发完成，等待新任务"
})

# 返回（如果收到新任务）：
# 🔔 待命检查：收到新任务/消息，继续工作
# 📋 新任务 (1个): ...
# 💡 请处理上述任务/消息，处理完成后继续调用standby继续监听

# 处理完任务后，继续调用standby
standby({
  "status_message": "任务处理完成，继续监听"
})

# 开始新的5分钟监听周期...
```

---

## 🔧 参数说明

### 基本参数

- **status_message** (string, 可选)
  - 待命状态消息
  - 用于说明当前状态

### 检查选项

- **check_tasks** (boolean, 默认: true)
  - 是否检查任务
  - 检查分配给当前AI的任务（状态：待开始、进行中）

- **check_messages** (boolean, 默认: true)
  - 是否检查消息
  - 检查发给当前AI的未读消息

### 自动处理

- **auto_read** (boolean, 默认: true)
  - 是否自动读取新任务/消息内容
  - true: 自动读取并返回内容
  - false: 只返回通知

---

## 💡 使用示例

### 示例1: 基础使用（5分钟定时器）

```
standby({
  "status_message": "前端开发完成，等待新任务"
})
```

**返回**（如果没有新任务）：
```
✅ 待命状态：持续监听中（5分钟定时器）

待命ID: a_session123_2025-11-10T12:00:00
剩余时间: 4分58秒
检查时间: 2025-11-10 12:00:00
状态: 前端开发完成，等待新任务

💡 提示: 暂无新任务/消息，继续监听中...
请在剩余时间内继续调用standby检查，或处理完其他工作后继续调用standby
```

**返回**（如果收到新任务）：
```
🔔 待命检查：收到新任务/消息，继续工作

📋 新任务 (1个):

--- 任务 TASK_001 ---
标题: 实现知识库本地文件夹挂载功能
优先级: P0
状态: 待开始
描述: 参考Cursor IDE实现...

✅ 待命状态已激活（5分钟定时器）
待命ID: a_session123_2025-11-10T12:00:00
剩余时间: 4分30秒
状态: 前端开发完成，等待新任务

💡 请处理上述任务/消息，处理完成后继续调用standby继续监听
```

### 示例2: 5分钟到期

```
# 5分钟后调用standby
standby({
  "status_message": "继续监听"
})

# 返回：
# ⏰ 5分钟定时器已到期，重置定时器
# 待命ID: a_session123_2025-11-10T12:00:00
# 检查时间: 2025-11-10 12:05:00
# 💡 提示: 5分钟内未收到新任务/消息，定时器已重置
# 请继续调用standby开始新的5分钟监听周期
```

---

## 🔄 5分钟定时器机制

### 定时器行为

1. **启动定时器**：第一次调用standby时，启动5分钟定时器
2. **持续监听**：在5分钟内，每次调用standby都会检查是否有新任务/消息
3. **立即响应**：如果收到新任务/消息，立即返回，定时器继续运行
4. **到期重置**：5分钟到期后，定时器重置，可以开始新的监听周期

### 关键要点

- ✅ **固定5分钟**：定时器强制为5分钟，不能修改
- ✅ **持续监听**：在5分钟内可以多次调用standby检查
- ✅ **立即响应**：收到新任务/消息时立即返回
- ✅ **自动重置**：5分钟到期后自动重置

---

## ✅ 使用检查清单

- [ ] 在回复末尾调用 `standby`
- [ ] 查看standby返回的结果
- [ ] 如果有新任务/消息，处理它们
- [ ] 在5分钟内多次调用standby检查
- [ ] 处理完任务后，继续调用standby开始新的5分钟监听周期

---

## 💡 注意事项

1. **固定5分钟定时器**：定时器强制为5分钟，不能修改
2. **持续监听**：在5分钟内可以多次调用standby检查
3. **立即响应**：收到新任务/消息时立即返回，继续工作
4. **自动重置**：5分钟到期后自动重置，可以开始新的监听周期

---

## 📚 相关文档

- **协作工具指南**: `mcp_ai_chat/COLLABORATION_TOOLS_GUIDE.md`
- **群聊使用指南**: `mcp_ai_chat/GROUP_CHAT_GUIDE.md`
- **员工配置指南**: `mcp_ai_chat/EMPLOYEE_CONFIG_GUIDE.md`

---

**文档版本**: v4.1.0  
**最后更新**: 2025-11-10  
**维护者**: 产品经理
