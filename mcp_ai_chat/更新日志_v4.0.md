# AI群聊MCP工具 - 更新日志 v4.0

> **更新版本**: v4.0.0  
> **更新日期**: 2025-11-10  
> **更新内容**: 员工设定接口 - 自动拾取任务和加载配置

---

## 🎯 更新目的

解决新聊天的AI需要手动输入角色和描述，以及无法自动拾取前员工任务的问题。

---

## ✨ 新增功能

### 1. 员工配置接口

- ✅ **set_employee_config** 工具：设置员工配置，指定.mdc文件路径
- ✅ 支持自动从`.cursor/rules/{agent_name}.mdc`文件读取角色和描述
- ✅ 支持自定义.mdc文件路径

### 2. register_agent 增强

- ✅ **自动拾取任务**：如果`agent_name`已存在，自动显示分配给该员工的任务
- ✅ **自动加载配置**：如果设置了员工配置，自动从.mdc文件读取角色和描述
- ✅ **继承配置**：如果之前注册过，自动继承之前的角色和描述
- ✅ **智能提示**：显示待处理任务列表，帮助新AI快速了解工作

### 3. .mdc文件解析

- ✅ 自动从.mdc文件标题提取角色（例如：`# 员工A - 前端开发工程师`）
- ✅ 自动从register_agent示例中提取角色和描述
- ✅ 自动从职责描述中提取描述信息

---

## 🔄 变更内容

### 1. register_agent 工具变更

**之前**：
```json
{
  "agent_name": "a",
  "role": "前端开发工程师",  // 必填
  "description": "前端开发工程师，负责前端功能开发和UI/UX优化"
}
```

**现在**：
```json
{
  "agent_name": "a",  // 必填
  "role": "前端开发工程师",  // 可选，自动从.mdc文件或之前的配置加载
  "description": "...",  // 可选，自动从.mdc文件或之前的配置加载
  "auto_load_from_mdc": true  // 默认true，自动从.mdc文件加载
}
```

### 2. 新增工具

**set_employee_config**：
```json
{
  "agent_name": "a",
  "mdc_file_path": ".cursor/rules/a.mdc"  // 可选，默认使用 .cursor/rules/{agent_name}.mdc
}
```

### 3. 数据存储变更

**新增文件**：
- `employee_config.json`: 存储员工配置（.mdc文件路径）

**agents.json 增强**：
- 新增 `previous_registered_at` 字段，记录之前的注册时间

---

## 📋 使用示例

### 示例1：新AI接替前员工工作

```
# 步骤1：设置员工配置（可选，如果.mdc文件在默认位置）
set_employee_config({
  "agent_name": "a"
})

# 步骤2：注册代理（自动加载）
register_agent({
  "agent_name": "a"
})

# 返回：
# ✅ AI代理已注册并创建会话
# 📋 发现 2 个待处理任务:
#   - TASK_001: 实现知识库本地文件夹挂载功能 (待开始)
#   - TASK_002: 前端UI优化 (进行中)
```

### 示例2：AI重启后重新注册

```
register_agent({
  "agent_name": "a"
})

# 自动继承之前的角色和描述
# 自动显示待处理任务
```

### 示例3：首次注册新员工

```
# 步骤1：创建 .cursor/rules/e.mdc 文件
# 步骤2：设置配置
set_employee_config({
  "agent_name": "e"
})

# 步骤3：注册
register_agent({
  "agent_name": "e"
})
```

---

## 🔍 技术实现

### 1. .mdc文件解析

- **角色提取**：从标题行（`# 员工A - 前端开发工程师`）或register_agent示例中提取
- **描述提取**：从register_agent示例的description字段或包含"负责"的行中提取

### 2. 任务拾取

- 注册时自动查询分配给该`agent_name`的任务
- 只显示状态为"待开始"或"进行中"的任务
- 最多显示5个任务，超过则显示总数

### 3. 配置继承

- 检查`agents.json`中是否有之前的注册信息
- 如果存在，自动继承角色和描述
- 如果设置了员工配置，优先从.mdc文件加载

---

## ⚠️ 迁移指南

### 对于已注册的AI

无需迁移，现有功能完全兼容。新功能是可选的：
- 如果想使用自动加载，调用`set_employee_config`设置配置
- 如果不想使用，继续手动提供角色和描述

### 对于新AI

推荐使用新功能：
1. 调用`set_employee_config`设置配置（如果.mdc文件在默认位置可跳过）
2. 调用`register_agent`注册，自动加载配置和任务

---

## 📚 相关文档

- **员工配置指南**: `mcp_ai_chat/EMPLOYEE_CONFIG_GUIDE.md`
- **协作工具指南**: `mcp_ai_chat/COLLABORATION_TOOLS_GUIDE.md`
- **会话和角色指南**: `mcp_ai_chat/SESSION_ROLE_GUIDE.md`

---

**文档版本**: v4.0.0  
**最后更新**: 2025-11-10  
**维护者**: 产品经理




